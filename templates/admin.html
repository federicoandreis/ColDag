{% extends "base.html" %}

{% block content %}
<h1>Admin Dashboard</h1>

<h2>User Management</h2>
<a href="{{ url_for('user_activity') }}">View User Activity Logs</a>
<table>
    <thead>
        <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Role</th>
            <th>Is Admin</th>
            <th>Is Active</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for user in users %}
        <tr>
            <td>{{ user.username }}</td>
            <td>{{ user.email }}</td>
            <td>
                <form action="{{ url_for('change_role', user_id=user.id) }}" method="POST">
                    <select name="role_id" onchange="this.form.submit()">
                        {% for role in roles %}
                            <option value="{{ role.id }}" {% if user.role.id == role.id %}selected{% endif %}>
                                {{ role.name }}
                            </option>
                        {% endfor %}
                    </select>
                </form>
            </td>
            <td>{{ 'Yes' if user.is_admin else 'No' }}</td>
            <td>{{ 'Yes' if user.is_active else 'No' }}</td>
            <td>
                <a href="{{ url_for('toggle_admin', user_id=user.id) }}">
                    {{ 'Revoke Admin' if user.is_admin else 'Grant Admin' }}
                </a>
                |
                <a href="{{ url_for('toggle_active', user_id=user.id) }}">
                    {{ 'Deactivate' if user.is_active else 'Activate' }}
                </a>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<h2>All Projects</h2>
<button id="export-all-json">Export All JSON</button>
<ul>
{% for project in projects %}
    <li>
        <strong>{{ project.name }}</strong> (User ID: {{ project.user_id }})
        <pre>{{ project.content }}</pre>
    </li>
{% endfor %}
</ul>
<script>
document.getElementById('export-all-json').addEventListener('click', function() {
    window.location.href = '{{ url_for("export_all_graphs") }}';
});
</script>
{% endblock %}
