{% extends "base.html" %}

{% block content %}
<h1>User Profile</h1>
<div>
    <p><strong>Username:</strong> {{ current_user.username }}</p>
    <p><strong>Email:</strong> {{ current_user.email }} {% if not current_user.email_verified %}(Not verified){% endif %}</p>
    <p><strong>Account Created:</strong> {{ current_user.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
    <p><strong>Last Login:</strong> {{ current_user.last_login.strftime('%Y-%m-%d %H:%M:%S') if current_user.last_login else 'Never' }}</p>
    <p><strong>Role:</strong> {{ current_user.role.name }}</p>
    <p><strong>Two-Factor Authentication:</strong> {% if current_user.two_factor_secret %}Enabled{% else %}Disabled{% endif %}</p>
</div>

<h2>Edit Profile</h2>
<form method="POST">
    <label for="email">New Email:</label>
    <input type="email" id="email" name="email" value="{{ current_user.email }}">
    
    <label for="new_password">New Password:</label>
    <input type="password" id="new_password" name="new_password">
    
    <input type="submit" value="Update Profile">
</form>

<h2>Two-Factor Authentication</h2>
{% if current_user.two_factor_secret %}
    <form method="POST" action="{{ url_for('disable_2fa') }}">
        <input type="submit" value="Disable 2FA">
    </form>
{% else %}
    <a href="{{ url_for('enable_2fa') }}">Enable 2FA</a>
{% endif %}

<h2>Delete Account</h2>
<form method="POST" action="{{ url_for('delete_account') }}" onsubmit="return confirm('Are you sure you want to delete your account? This action cannot be undone.');">
    <label for="password">Enter your password to confirm:</label>
    <input type="password" id="password" name="password" required>
    <input type="submit" value="Delete Account">
</form>

<h2>Your Projects</h2>
<ul>
    {% for project in current_user.projects %}
    <li>{{ project.name }} (Created: {{ project.created_at.strftime('%Y-%m-%d %H:%M:%S') }})</li>
    {% endfor %}
</ul>
{% endblock %}
